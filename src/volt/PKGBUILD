
name=volt
prefix=$HOME/local/$name
repos=$name
depends=()
src_depends=(gvm)

required_major_version=1
required_minor_version=11
required_patch_version=1
repo_url='github.com/vim-volt/volt'

update() {
  git --git-dir=$name/.git pull --quiet --rebase
}

build() {
  check_go_cmd && go get -d $repo_url
}

check_go_cmd() {
  if ! type go; then
    echo "'go' command is not installed" >&2
    return 1
  fi
  return 0
}

package() {
  check_version && go install $repo_url
}

check_version() {
  local version=$(go version | sed -E 's/go version go([0-9.]+).*/\1/')
  local vers=$(echo "$version" | tr '.' ' ')
  local major=$required_major_version
  local minor=$required_minor_version
  local patch=$required_patch_version
  if ! perl -E "exit(\$ARGV[0] >= $major && \$ARGV[1] >= $minor && \$ARGV[2] >= $patch ? 0 : 1)" $vers; then
    echo "go version is not 1.11.1 or higher" >&2
    return 2
  fi
  return 0
}
